---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { PAYSTACK_PUBLIC_KEY } from "../consts";
---

<Layout title="Wishlist">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://js.paystack.co/v1/inline.js" defer></script>
    <Header />
    <h1 class="text-3xl md:text-4xl font-bold mb-1">Birthday Wishlist</h1>
    <div class="rounded-xl border border-zinc-200 bg-white/60 backdrop-blur-2xl p-4">
      <p class="text-sm text-gray-700 leading-relaxed">
        A simple place for friends and family to make my birthday easier (and more thoughtful).
        If you want to get me something, here are a few ideas. No pressure—messages and small moments count too.
      </p>
    </div>

    <div class="mt-4 flex items-center justify-between text-[13px]">
      <div class="text-gray-600">If you're here — thank you. Small gestures mean a lot.</div>
      <div x-data="{ copied: false, copy(){ navigator.clipboard && navigator.clipboard.writeText(window.location.href).then(()=>{ this.copied=true; setTimeout(()=>this.copied=false, 1400); }); } }" class="w-full sm:w-auto sm:flex sm:justify-end">
        <button @click="copy()" class="w-full sm:w-auto px-4 py-2 rounded-md border border-zinc-300 bg-white/90 font-semibold hover:bg-white transition-colors">
          <span x-show="!copied">Copy wishlist link</span>
          <span x-show="copied">Link copied ✓</span>
        </button>
      </div>
    </div>

    <div class="mt-6 grid gap-4">
      <div class="rounded-xl border border-zinc-50 bg-white/30 backdrop-blur-2xl p-3" x-data="{ open: false }">
        <div class="flex items-center justify-between gap-2">
          <div class="text-[13px] text-gray-700">Would you use something like this?</div>
          <button @click="open = !open" class="text-[13px] underline decoration-dashed underline-offset-4 hover:text-indigo-600">I'm interested</button>
        </div>
        <div x-show="open" class="mt-2">
          <form name="wishlist-interest" method="POST" data-netlify="true" netlify-honeypot="bot-field" action="/wishlist" class="flex flex-col sm:flex-row sm:items-center gap-2">
            <input type="hidden" name="form-name" value="wishlist-interest" />
            <input type="text" name="bot-field" class="hidden" tabindex="-1" autocomplete="off" />
            <input required name="email" type="email" placeholder="you@example.com" class="px-3 py-1.5 text-sm rounded-md border border-zinc-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-indigo-400" />
            <button type="submit" class="px-3 py-1.5 text-sm rounded-md border border-zinc-300 bg-white/80 font-semibold hover:bg-white transition-colors">Send</button>
            <div class="text-[12px] text-gray-500">Just to keep you posted. No spam.</div>
          </form>
          {Astro.url.searchParams.get('success') === '1' && (
            <div class="mt-2 text-[12px] text-emerald-700">Thanks — noted. I’ll keep you posted.</div>
          )}
        </div>
      </div>
      <div class="rounded-xl border border-zinc-200 bg-white/70 p-4">
        <h2 class="font-semibold">How it works</h2>
        <ul class="mt-2 text-sm text-gray-700 space-y-2">
          <li class="flex gap-2"><span class="text-gray-400">•</span><span>Pick something you like from the list</span></li>
          <li class="flex gap-2"><span class="text-gray-400">•</span><span>Contribute to a group gift or choose a small item</span></li>
          <li class="flex gap-2"><span class="text-gray-400">•</span><span>Or pledge a support gift (meal, help, a note)</span></li>
        </ul>
      </div>

      <div class="h-px bg-gradient-to-r from-transparent via-zinc-200 to-transparent"></div>

      <div class="rounded-xl border border-zinc-200 bg-white/70 p-4">
        <h2 class="font-semibold">Group gifts</h2>
        <p class="mt-2 text-sm text-gray-600">Bigger things we can chip in on together. A short note about why you picked it would make my day.</p>
        <div class="mt-3 space-y-3">
          <div class="rounded-lg border border-zinc-200 p-3 bg-white/80">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-medium">New laptop</div>
                <div class="text-xs text-gray-500">Goal: GHS 7,000</div>
              </div>
              <div class="text-xs text-gray-600">0% funded</div>
            </div>
            <div class="mt-2 h-2 w-full bg-zinc-100 rounded-full overflow-hidden">
              <div class="h-full w-0 bg-indigo-500 transition-all"></div>
            </div>
            <div class="mt-2 flex flex-wrap items-center gap-2 gap-y-2 text-sm" x-data="{ amount: '', email: '', loading: false, error: '', success: '', setPreset(v){ this.amount = String(v) }, valid(){ return this.email && /.+@.+\..+/.test(this.email) && Number(this.amount) >= 1 }, pay(){ if(!this.valid()){ this.error='Enter a valid email and amount (≥ 1)'; this.success=''; return; } this.error=''; this.loading=true; try { window.PaystackPop && window.PaystackPop.setup({ key: PAYSTACK_PUBLIC_KEY, email: this.email, amount: Math.round(Number(this.amount) * 100), currency: 'GHS', metadata: { purpose: 'Group gift: Laptop' }, callback: () => { this.success='Thanks for contributing!'; this.loading=false; this.amount=''; }, onClose: () => { this.loading=false; } }).openIframe(); } catch (e) { this.error='Payment failed to initialize. Please try again.'; this.loading=false; } } }">
              <input x-model="email" type="email" inputmode="email" placeholder="you@example.com" aria-label="Your email" class="px-2 py-1 rounded-md border border-zinc-300 bg-white/90 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-full sm:w-auto" :class="error && !/.+@.+\..+/.test(email) ? 'border-rose-300' : ''" />
              <div class="relative w-full sm:w-auto">
                <input x-model="amount" type="number" min="1" step="1" placeholder="Amount" aria-label="Amount in GHS" class="pr-12 px-2 py-1 rounded-md border border-zinc-300 bg-white/90 w-full sm:w-36 focus:outline-none focus:ring-2 focus:ring-indigo-400" :class="error && Number(amount) < 1 ? 'border-rose-300' : ''" />
                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500">GHS</span>
              </div>
              <div class="flex flex-wrap items-center gap-1 w-full sm:w-auto">
                <button type="button" @click="setPreset(50)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 50</button>
                <button type="button" @click="setPreset(100)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 100</button>
                <button type="button" @click="setPreset(200)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 200</button>
              </div>
              <button @click="pay()" :disabled="!valid() || loading" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600 disabled:opacity-60 disabled:cursor-not-allowed w-full sm:w-auto">Contribute</button>
              <div class="w-full">
                <div class="text-[12px] text-gray-500">Your email is for the receipt only.</div>
                <template x-if="error">
                  <div class="text-[12px] text-rose-600 mt-1" x-text="error" aria-live="polite"></div>
                </template>
                <template x-if="success">
                  <div class="text-[12px] text-emerald-700 mt-1" x-text="success" aria-live="polite"></div>
                </template>
              </div>
              <span class="text-gray-300">•</span>
              <a href="mailto:gideonad.codez@gmail.com?subject=Quick%20question%20about%20the%20wishlist&body=Hey%20Gideon%2C%0D%0A%0D%0AI%20had%20a%20quick%20question%20about%20the%20group%20gift%3A%20___" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600">Ask a question</a>
            </div>
          </div>
        </div>
        <div class="mt-3 space-y-3">
          <div class="rounded-lg border border-zinc-200 p-3 bg-white/80">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-medium">Mobile device</div>
                <div class="text-xs text-gray-500">Goal: GHS 3,000</div>
              </div>
              <div class="text-xs text-gray-600">0% funded</div>
            </div>
            <div class="mt-2 h-2 w-full bg-zinc-100 rounded-full overflow-hidden">
              <div class="h-full w-0 bg-indigo-500 transition-all"></div>
            </div>
            <div class="mt-2 flex flex-wrap items-center gap-2 gap-y-2 text-sm" x-data="{ amount: '', email: '', loading: false, error: '', success: '', setPreset(v){ this.amount = String(v) }, valid(){ return this.email && /.+@.+\..+/.test(this.email) && Number(this.amount) >= 1 }, pay(){ if(!this.valid()){ this.error='Enter a valid email and amount (≥ 1)'; this.success=''; return; } this.error=''; this.loading=true; try { window.PaystackPop && window.PaystackPop.setup({ key: PAYSTACK_PUBLIC_KEY, email: this.email, amount: Math.round(Number(this.amount) * 100), currency: 'GHS', metadata: { purpose: 'Group gift: Mobile device' }, callback: () => { this.success='Thanks for contributing!'; this.loading=false; this.amount=''; }, onClose: () => { this.loading=false; } }).openIframe(); } catch (e) { this.error='Payment failed to initialize. Please try again.'; this.loading=false; } } }">
              <input x-model="email" type="email" inputmode="email" placeholder="you@example.com" aria-label="Your email" class="px-2 py-1 rounded-md border border-zinc-300 bg-white/90 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-full sm:w-auto" :class="error && !/.+@.+\..+/.test(email) ? 'border-rose-300' : ''" />
              <div class="relative w-full sm:w-auto">
                <input x-model="amount" type="number" min="1" step="1" placeholder="Amount" aria-label="Amount in GHS" class="pr-12 px-2 py-1 rounded-md border border-zinc-300 bg-white/90 w-full sm:w-36 focus:outline-none focus:ring-2 focus:ring-indigo-400" :class="error && Number(amount) < 1 ? 'border-rose-300' : ''" />
                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500">GHS</span>
              </div>
              <div class="flex flex-wrap items-center gap-1 w-full sm:w-auto">
                <button type="button" @click="setPreset(50)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 50</button>
                <button type="button" @click="setPreset(100)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 100</button>
                <button type="button" @click="setPreset(200)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 200</button>
              </div>
              <button @click="pay()" :disabled="!valid() || loading" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600 disabled:opacity-60 disabled:cursor-not-allowed w-full sm:w-auto">Contribute</button>
              <div class="w-full">
                <div class="text-[12px] text-gray-500">Your email is for the receipt only.</div>
                <template x-if="error">
                  <div class="text-[12px] text-rose-600 mt-1" x-text="error" aria-live="polite"></div>
                </template>
                <template x-if="success">
                  <div class="text-[12px] text-emerald-700 mt-1" x-text="success" aria-live="polite"></div>
                </template>
              </div>
              <span class="text-gray-300">•</span>
              <a href="mailto:gideonad.codez@gmail.com?subject=Quick%20question%20about%20the%20wishlist&body=Hey%20Gideon%2C%0D%0A%0D%0AI%20had%20a%20quick%20question%20about%20the%20group%20gift%3A%20___" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600">Ask a question</a>
            </div>
          </div>
        </div>
      </div>

      <div class="h-px bg-gradient-to-r from-transparent via-zinc-200 to-transparent"></div>

      <div class="rounded-xl border border-zinc-200 bg-white/70 p-4">
        <h2 class="font-semibold">Items</h2>
        <p class="mt-2 text-sm text-gray-600">Simple picks I use or would genuinely enjoy. If you grab one, a short note would be lovely.</p>
        <div class="mt-3 space-y-2 text-sm">
          <div class="flex items-start justify-between gap-3 rounded-lg border border-zinc-200 p-3 bg-white/80">
            <div>
              <div class="font-medium">Laptop desk</div>
              <div class="text-xs text-gray-500">Adjustable, portable</div>
            </div>
            <div class="flex items-center gap-3">
              <a href="mailto:gideonad.codez@gmail.com?subject=Reserve%3A%20Laptop%20desk&body=Hey%20Gideon%2C%0D%0A%0D%0AI%27ll%20grab%20this.%20Planning%20to%20order%20by%20____.%0D%0A(Optional)%20Short%20note%3A%20___" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600">Reserve</a>
              <span class="text-gray-300">•</span>
              <a href="mailto:gideonad.codez@gmail.com?subject=Purchased%3A%20Laptop%20desk&body=Got%20it%E2%80%94arrives%20around%20____.%0D%0A(Optional)%20Short%20note%3A%20___" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600">Mark purchased</a>
            </div>
          </div>
        </div>
      </div>

      <div class="h-px bg-gradient-to-r from-transparent via-zinc-200 to-transparent"></div>

      <div class="rounded-xl border border-zinc-200 bg-white/70 p-4">
        <h2 class="font-semibold">Support gifts</h2>
        <p class="mt-2 text-sm text-gray-600">Non‑material gifts that matter just as much. If you pledge one, feel free to suggest a day that works.</p>
        <ul class="mt-3 text-sm text-gray-700 space-y-2">
          <li class="flex items-start gap-2"><span class="text-gray-400">•</span><span>Home-cooked meal night</span></li>
          <li class="flex items-start gap-2"><span class="text-gray-400">•</span><span>Help with a weekend errand</span></li>
          <li class="flex items-start gap-2"><span class="text-gray-400">•</span><span>A short note or card</span></li>
        </ul>
        <div class="mt-3 text-sm">
          <a href="mailto:gideonad.codez@gmail.com?subject=Support%20gift%20pledge&body=Hey%20Gideon%2C%0D%0A%0D%0AI%E2%80%99d%20love%20to%20help%20with%20___%20around%20____.%0D%0A(Optional)%20Short%20note%3A%20___" class="underline decoration-dashed underline-offset-4 hover:text-indigo-600">Pledge a support gift</a>
        </div>
      </div>

      <div class="rounded-xl border border-zinc-200 bg-white/70 p-4">
        <h2 class="font-semibold">Cash fund</h2>
        <p class="mt-2 text-sm text-gray-600">If you'd rather, a small general contribution is always appreciated.</p>
        <div class="mt-3 flex flex-wrap items-center gap-2 gap-y-2 text-sm" x-data="{ email: '', amount: '', loading: false, error: '', success: '', setPreset(v){ this.amount = String(v) }, valid(){ return this.email && /.+@.+\..+/.test(this.email) && Number(this.amount) >= 1 }, pay(){ if(!this.valid()){ this.error='Enter a valid email and amount (≥ 1)'; this.success=''; return; } this.error=''; this.loading=true; try { window.PaystackPop && window.PaystackPop.setup({ key: PAYSTACK_PUBLIC_KEY, email: this.email, amount: Math.round(Number(this.amount) * 100), currency: 'GHS', metadata: { purpose: 'Cash fund' }, callback: () => { this.success='Thanks for contributing!'; this.loading=false; this.amount=''; }, onClose: () => { this.loading=false; } }).openIframe(); } catch (e) { this.error='Payment failed to initialize. Please try again.'; this.loading=false; } } }">
          <input x-model="email" type="email" inputmode="email" placeholder="you@example.com" aria-label="Your email" class="px-2 py-1 rounded-md border border-zinc-300 bg-white/90 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-full sm:w-auto" :class="error && !/.+@.+\..+/.test(email) ? 'border-rose-300' : ''" />
          <div class="relative w-full sm:w-auto">
            <input x-model="amount" type="number" min="1" step="1" placeholder="Amount" aria-label="Amount in GHS" class="pr-12 px-2 py-1 rounded-md border border-zinc-300 bg-white/90 w-full sm:w-36 focus:outline-none focus:ring-2 focus:ring-indigo-400" :class="error && Number(amount) < 1 ? 'border-rose-300' : ''" />
            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500">GHS</span>
          </div>
          <div class="flex flex-wrap items-center gap-1 w-full sm:w-auto">
            <button type="button" @click="setPreset(20)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 20</button>
            <button type="button" @click="setPreset(50)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 50</button>
            <button type="button" @click="setPreset(100)" class="px-2 py-1 rounded-md border border-zinc-200 text-[12px] hover:bg-white">GHS 100</button>
          </div>
          <button @click="pay()" :disabled="!valid() || loading" class="inline-flex items-center justify-center px-3 py-2 rounded-md border border-zinc-300 bg-white/90 hover:bg-white disabled:opacity-60 disabled:cursor-not-allowed transition-colors w-full sm:w-auto">Contribute</button>
          <div class="w-full">
            <div class="text-[12px] text-gray-500">Your email is for the receipt only.</div>
            <template x-if="error">
              <div class="text-[12px] text-rose-600 mt-1" x-text="error" aria-live="polite"></div>
            </template>
            <template x-if="success">
              <div class="text-[12px] text-emerald-700 mt-1" x-text="success" aria-live="polite"></div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>
  <Footer />
</Layout>


