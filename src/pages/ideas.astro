---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import ideas from "../libs/ideas.json";
---

<Layout title="Messy ideas">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <Header />
    <h1 class="text-3xl md:text-4xl font-bold mb-2">Messy, rough ideas</h1>
    <div class="rounded-xl border border-zinc-200 bg-white/60 backdrop-blur-2xl p-4 md:w-3/4">
      <p class="text-sm text-gray-700 leading-relaxed">
        A public scratchpad of ideas — mine and good ones I’ve found. Steal them. Remix them. If you build something, I’ll cheer you on and credit the source.
      </p>
    </div>

    <!-- Alpine for lightweight modal UX -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <div
      x-data={`({
        open: false,
        current: 0,
        ideas: ${JSON.stringify(ideas)},
        randomOpen() {
          if (!this.ideas || !this.ideas.length) return;
          const i = Math.floor(Math.random() * this.ideas.length);
          this.setCurrent(i);
        },
        openFromHash() {
          const m = (window.location.hash || '').match(/#idea-(\d+)/);
          if (m) { const i = Number(m[1]) || 0; if (i >= 0 && i < this.ideas.length) { this.current = i; this.open = true; } }
        },
        setCurrent(i) {
          this.current = i;
          this.open = true;
          history && history.replaceState && history.replaceState(null, '', '#idea-' + i);
        },
        closeModal() {
          this.open = false;
          history && history.replaceState && history.replaceState(null, '', ' ');
        },
        copyLink() {
          const url = window.location.origin + window.location.pathname + '#idea-' + this.current;
          navigator.clipboard && navigator.clipboard.writeText(url).catch(() => {});
        }
      })`}
      x-init="openFromHash()"
      class="mt-6"
    >
      <div class="mb-4 flex flex-wrap items-center gap-2 text-[11px]">
        <button @click="randomOpen()" class="px-2.5 py-1 rounded-full border border-zinc-300 bg-white/80 font-semibold hover:bg-white">Random idea</button>
        <a href="mailto:gideonad.codez@gmail.com?subject=New%20idea%20submission&body=Title%3A%20%0D%0AMemo%3A%20%0D%0AWhy%20it%20matters%3A%20%0D%0AHow%20I%27d%20build%20it%3A%20%0D%0A" class="px-2.5 py-1 rounded-full border border-zinc-300 bg-white/70 font-semibold hover:bg-white">Submit your idea</a>
        <span class="opacity-50">/</span>
        <span class="px-2 py-0.5 rounded-full border border-indigo-100 text-indigo-600 bg-indigo-50/60">WIP</span>
        <span class="px-2 py-0.5 rounded-full border border-amber-100 text-amber-700 bg-amber-50/60">Rough/Draft</span>
      </div>
       <div class="messy-masonry messy-grid">
       {ideas.map((idea, idx) => {
        const status = String(idea.status || '').toLowerCase();
        const badge = status === 'wip'
          ? 'border-indigo-100 text-indigo-600 bg-indigo-50/60'
          : status.includes('rough') || status.includes('draft')
          ? 'border-amber-100 text-amber-700 bg-amber-50/60'
          : 'border-slate-100 text-slate-600 bg-slate-50/60';
        const mail = `mailto:gideonad.codez@gmail.com?subject=I%20want%20to%20build%3A%20${encodeURIComponent(idea.title)}&body=Hi%20Gideon%2C%0D%0A%0D%0AI%27m%20interested%20in%20building%20this%20idea%3A%20${encodeURIComponent(idea.title)}.%0D%0AHere%27s%20my%20plan%20and%20what%20I%27ll%20try%20first%3A%20%0D%0A%0D%0A-%20%0D%0A-%20%0D%0A-%20%0D%0A%0D%0AWill%20share%20progress%20soon.`;
        return (
           <div id={`idea-${idx}`} class="relative inline-block align-top w-full overflow-hidden rounded-xl border border-zinc-200 bg-white/60 backdrop-blur-2xl p-4 idea-card">
            <div class="pointer-events-none absolute -top-10 -left-10 w-28 h-28 rounded-full bg-amber-100/25 blur-2xl"></div>
            <div class="pointer-events-none absolute -bottom-12 -right-12 w-32 h-32 rounded-full bg-indigo-100/25 blur-2xl"></div>
            <div class="relative flex items-start justify-between gap-3">
               <div class="min-w-0">
                <h2 class="font-semibold leading-snug">{idea.title}</h2>
                <p class="mt-2 text-sm text-gray-700 leading-relaxed line-clamp-3">{idea.memo}</p>
                {idea.updated && (
                  <div class="mt-1 text-[11px] text-gray-500">Updated: {idea.updated}</div>
                )}
                 {idea.source && (
                   <div class="mt-0.5 text-[11px] text-gray-500">Source: {idea.source}</div>
                 )}
              </div>
              <span class={`shrink-0 px-2 py-0.5 rounded-full border text-[11px] ${badge}`}>{idea.status}</span>
            </div>
             <div class="mt-4 flex items-center gap-3 text-[11px]">
               <button @click={`setCurrent(${idx})`} class="px-2.5 py-1 rounded-full border border-zinc-300 bg-white/80 font-semibold hover:bg-white">Open</button>
              <a href={mail} class="underline decoration-dashed underline-offset-4">Build this</a>
              <a href="/contact" class="underline decoration-dashed underline-offset-4">Say hi</a>
            </div>
          </div>
        );
      })}
      </div>

      <!-- Modal -->
      <div
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        @keydown.escape.window="open=false"
        class="fixed inset-0 z-50 flex items-center justify-center p-4"
        style="display: none;"
      >
         <div class="absolute inset-0 bg-black/30 backdrop-blur-sm" @click="closeModal()"></div>
         <div class="relative w-full max-w-2xl rounded-2xl border border-zinc-200 bg-white/95 p-5 shadow-xl">
          <div class="flex items-start justify-between gap-3">
            <h3 class="font-semibold text-lg" x-text="ideas[current].title"></h3>
             <div class="flex items-center gap-2">
               <button @click="copyLink()" class="px-2 py-1 text-sm rounded-full border border-zinc-300 bg-white/80 hover:bg-white">Copy link</button>
               <button @click="closeModal()" class="px-2 py-1 text-sm rounded-full border border-zinc-300 bg-white/80 hover:bg-white">Close</button>
             </div>
          </div>
          <div class="mt-2 text-sm text-gray-700 leading-relaxed" x-text="ideas[current].memo"></div>
          <template x-if="ideas[current].implementation && ideas[current].implementation.length">
            <div class="mt-4">
              <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">How I’d do it</div>
              <ul class="list-disc ms-5 text-sm text-gray-700 space-y-1">
                <template x-for="step in ideas[current].implementation" :key="step">
                  <li x-text="step"></li>
                </template>
              </ul>
            </div>
          </template>
          <div class="mt-4 flex items-center justify-between">
            <div class="flex items-center gap-1">
              <template x-for="(it, i) in ideas" :key="i">
                <button @click="current=i" :class="i === current ? 'bg-zinc-800' : 'bg-zinc-300'" class="w-1.5 h-1.5 rounded-full"></button>
              </template>
            </div>
            <div class="flex items-center gap-2 text-sm">
              <button @click="current = (current - 1 + ideas.length) % ideas.length" class="px-2 py-1 rounded-full border border-zinc-300 bg-white/80 hover:bg-white">Prev</button>
              <button @click="current = (current + 1) % ideas.length" class="px-2 py-1 rounded-full border border-zinc-300 bg-white/80 hover:bg-white">Next</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>


<style>
  /* playful scatter with restraint; hover recenters for readability */
  .messy-grid .idea-card {
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    will-change: transform;
    margin-left: -2px;
    margin-right: -2px;
    width: calc(100% + 4px);
    break-inside: avoid;
    -webkit-column-break-inside: avoid;
    page-break-inside: avoid;
  }
  /* masonry columns */
  .messy-masonry {
    column-count: 1;
    column-gap: 1rem;
  }
  @media (min-width: 768px) {
    .messy-masonry { column-count: 2; column-gap: 1rem; }
    .messy-grid .idea-card:nth-child(6n+1) { transform: rotate(-0.6deg) translateY(2px); }
    .messy-grid .idea-card:nth-child(6n+2) { transform: rotate(0.8deg) translateY(1px); }
    .messy-grid .idea-card:nth-child(6n+3) { transform: rotate(-1deg) translateY(3px); }
    .messy-grid .idea-card:nth-child(6n+4) { transform: rotate(0.5deg) translateY(0px); }
    .messy-grid .idea-card:nth-child(6n+5) { transform: rotate(-0.3deg) translateY(2px); }
    .messy-grid .idea-card:nth-child(6n)   { transform: rotate(1deg) translateY(1px); }
    .messy-grid .idea-card:hover {
      transform: rotate(0deg) translateY(-2px) scale(1.008);
      border-color: rgba(24,24,27,.25);
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      z-index: 2;
    }
    .messy-grid { overflow: visible; }
    .messy-grid .idea-card { margin-left: -6px; margin-right: -6px; width: calc(100% + 12px); }
  }
  @media (min-width: 1024px) {
    .messy-masonry { column-count: 3; column-gap: 1.25rem; }
  }
</style>
