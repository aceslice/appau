---
import { BIRTHDAY_MONTH, WISHLIST_NAV_WINDOW_MONTHS } from "../consts";
const currentPath = Astro.url.pathname || "/";
const baseLinks = [
  { name: "Home", icon: "i-lucide-home", href: "/" },
  { name: "About", icon: "i-lucide-user", href: "/about" },
  { name: "Projects", icon: "i-lucide-code", href: "/projects" },
  { name: "Blog", icon: "i-lucide-notebook", href: "/blog" },
  { name: "Contact", icon: "i-lucide-mail", href: "/contact" },
  { name: "Autograph", icon: "i-lucide-signature", href: "/autograph" },
];

// Compute if Wishlist should show (server-rendered time)
const now = new Date();
const currentMonth = now.getMonth() + 1; // 1-12
const monthsBefore = ((BIRTHDAY_MONTH - currentMonth + 12) % 12);
const withinWindow = monthsBefore <= WISHLIST_NAV_WINDOW_MONTHS || currentMonth === BIRTHDAY_MONTH;
const links = withinWindow
  ? [
      ...baseLinks,
      { name: "Wishlist ðŸŽ‰", icon: "i-lucide-gift", href: "/wishlist" },
    ]
  : baseLinks;
---

<!-- Include Alpine.js -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer
></script>

<div x-data="{ open: false, scrolled: false }" x-init="scrolled = window.scrollY > 8" @scroll.window="scrolled = window.scrollY > 8">
  <!-- Horizontal nav for md and up -->
  <nav
    :class="scrolled ? 'border-zinc-300 bg-white/70' : 'border-zinc-200 bg-white/40'"
    class="hidden md:flex flex-wrap justify-center gap-1 fixed top-4 transform w-full max-w-2xl px-2 py-2 rounded-2xl mx-auto border backdrop-blur-xl transition-all duration-300 hover:scale-[1.01] z-50"
  >
    {
      links.map((link, index) => (
        <a
          href={link.href}
          aria-current={currentPath === link.href ? 'page' : undefined}
          class={`flex items-center justify-center gap-2 px-3 py-2 font-medium text-xs rounded-xl transition-colors ${currentPath === link.href ? 'text-gray-900 bg-white' : 'text-gray-600 hover:text-gray-900'}`}
        >
          {link.name === "Autograph" && (
            <span class="i-lucide-signature" title="My mail" role="img" />
          )}
          <span>{link.name}</span>
        </a>
      ))
    }
  </nav>

  <!-- Hamburger button for sm screens -->
  <div class="md:hidden fixed top-4 right-4 z-50">
    <button
      @click="open = !open"
      class="p-2 rounded-xl bg-white/80 border border-gray-200 backdrop-blur-md"
    >
      <template x-if="!open">
        <svg
          class="w-6 h-6 text-gray-700"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </template>
      <template x-if="open">
        <svg
          class="w-6 h-6 text-gray-700"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </template>
    </button>
  </div>

  <!-- Mobile bottom sheet menu with smooth slide transition -->
  <nav
    x-show="open"
    x-transition:enter="transition transform duration-300"
    x-transition:enter-start="translate-y-full opacity-0"
    x-transition:enter-end="translate-y-0 opacity-100"
    x-transition:leave="transition transform duration-200"
    x-transition:leave-start="translate-y-0 opacity-100"
    x-transition:leave-end="translate-y-full opacity-0"
    @click.away="open = false"
    class="fixed bottom-0 left-0 right-0 bg-white/95 flex flex-col items-center justify-center space-y-2 z-40 md:hidden p-4 rounded-t-3xl backdrop-blur-xl border-t border-zinc-200"
  >
    {
      links.map((link) => (
        <a
          href={link.href}
          @click="open = false"
          class="w-full max-w-sm px-4 py-3 text-gray-800 font-semibold text-base rounded-xl hover:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400"
        >
          <div class="flex items-center gap-4">
            <div class={link.icon} />
            {link.name}
          </div>
        </a>
      ))
    }
  </nav>
</div>




